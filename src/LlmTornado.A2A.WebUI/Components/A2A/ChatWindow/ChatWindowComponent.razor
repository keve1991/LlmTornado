@using LlmTornado.A2A.WebUI.Models
@inject IJSRuntime JS

<div class="chat-window">
    <div class="chat-messages" @ref="chatMessagesElement">
        @foreach (var message in Messages)
        {
            <div class="message @(message.IsFromUser ? "user-message" : "assistant-message")">
                <div class="message-header">
                    <span class="message-role">@message.Role</span>
                    <span class="message-time">@message.Timestamp.ToString("HH:mm:ss")</span>
                    @if (!string.IsNullOrEmpty(message.TaskId))
                    {
                        <span class="message-task-id">Task: @message.TaskId</span>
                    }
                </div>
                
                <div class="message-content">
                    @if (message.Attachments.Any())
                    {
                        <div class="message-attachments">
                            @foreach (var attachment in message.Attachments)
                            {
                                <div class="attachment-display">
                                    @if (attachment.IsImage)
                                    {
                                        <img src="data:@attachment.MimeType;base64,@attachment.Base64Data" 
                                             alt="@attachment.Name" class="attachment-image" />
                                    }
                                    else
                                    {
                                        <div class="attachment-file">
                                            <span class="file-icon">ðŸ“„</span>
                                            <span class="file-name">@attachment.Name</span>
                                            <span class="file-size">(@FormatFileSize(attachment.Size))</span>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    }
                    
                    @if (!string.IsNullOrEmpty(message.Content))
                    {
                        <div class="message-text">
                            @((MarkupString)FormatMessageContent(message.Content))
                        </div>
                    }
                </div>
            </div>
        }
        
        @if (!Messages.Any())
        {
            <div class="no-messages">
                <div class="no-messages-icon">ðŸ’¬</div>
                <div class="no-messages-text">No messages yet. Send a message to get started!</div>
            </div>
        }
    </div>
    
    <div class="chat-actions">
        <button class="btn btn-sm btn-secondary" @onclick="ClearMessages">
            Clear Chat
        </button>
        <button class="btn btn-sm btn-secondary" @onclick="ScrollToBottom">
            Scroll to Bottom
        </button>
    </div>
</div>