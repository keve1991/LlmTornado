@using LlmTornado.A2A.WebUI.Models
@using LlmTornado.A2A.WebUI.Services
@using A2A
@inject SSEStreamingService StreamingService
@inject IJSRuntime JS

<div class="task-sender">
    <div class="task-input-section">
        <h3>Send Task</h3>
        
        <div class="message-input-group">
            <textarea @bind="messageText" @bind:event="oninput" @onkeydown="HandleKeyDown"
                      class="form-control message-input" rows="4" 
                      placeholder="Enter your message..." 
                      disabled="@(!IsEnabled || isSending)"></textarea>
            
            <div class="input-actions">
                <div class="file-section">
                    <InputFile OnChange="HandleFileSelected" multiple accept="*/*" 
                              class="file-input" id="file-input" disabled="@(!IsEnabled || isSending)" />
                    <label for="file-input" class="btn btn-secondary file-label">
                        ðŸ“Ž Attach Files
                    </label>
                </div>
                
                <button class="btn btn-primary send-btn" @onclick="SendMessage" 
                        disabled="@(!CanSend || isSending)">
                    @if (isSending)
                    {
                        <span class="spinner"></span>
                        <text>Sending...</text>
                    }
                    else
                    {
                        <text>Send</text>
                    }
                </button>
            </div>
        </div>

        @* File attachments preview *@
        @if (attachments.Any())
        {
            <div class="attachments-preview">
                <h4>Attached Files (@attachments.Count)</h4>
                <div class="attachments-list">
                    @foreach (var attachment in attachments)
                    {
                        <div class="attachment-item">
                            <div class="attachment-preview">
                                @if (attachment.IsImage)
                                {
                                    <img src="data:@attachment.MimeType;base64,@attachment.Base64Data" 
                                         alt="@attachment.Name" class="attachment-thumbnail" />
                                }
                                else
                                {
                                    <div class="file-icon">
                                        ðŸ“„
                                    </div>
                                }
                            </div>
                            <div class="attachment-info">
                                <div class="file-name">@attachment.Name</div>
                                <div class="file-details">
                                    <span class="file-type">@attachment.MimeType</span>
                                    <span class="file-size">@FormatFileSize(attachment.Size)</span>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-danger remove-attachment" 
                                    @onclick="() => RemoveAttachment(attachment)"
                                    disabled="@isSending">
                                Ã—
                            </button>
                        </div>
                    }
                </div>
            </div>
        }

        @if (!string.IsNullOrEmpty(SelectedServer?.Endpoint))
        {
            <div class="server-info">
                <small>Sending to: @SelectedServer.Endpoint</small>
            </div>
        }

        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="error-message">
                @errorMessage
                <button class="btn-close" @onclick="ClearError">Ã—</button>
            </div>
        }
    </div>
</div>